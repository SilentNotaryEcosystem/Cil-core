const fs = require('fs');
const {VM} = require('vm2');

const factory = require('../../testFactory');

const TIMEOUT_CODE = 100000;

const vm = new VM({
    timeout: TIMEOUT_CODE,
    sandbox: {
        createHash: str => factory.Crypto.createHash(str)
        // ...environment
    }
});

const strContractCode = fs.readFileSync('./tests/unit/ubixNsDid/didNsV1.js', 'utf-8');
// const strContractCode = fs.readFileSync('./tests/unit/ubixNsDid/test.js', 'utf-8');

const retVal = vm.run(strContractCode);

console.log('ZZZ', retVal);

// const retVal = vm.run(strPredefinedClassesCode + strCode + strCodeSuffix);

// const vm = new NodeVM({
//     require: {
//         external: true,
//         root: './'
//     }
// });

// vm.run(
//     `
//     var request = require('request');
//     request('http://www.google.com', function (error, response, body) {
//         console.error(error);
//         if (!error && response.statusCode == 200) {
//             console.log(body); // Show the HTML for the Google homepage.
//         }
//     });
// `,
//     'vm.js'
// );
